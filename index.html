<html>
	<head>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js" type="text/javascript"></script>
		<style>
			.clear {
				clear: both;
			}

			.custom_dist {
				font-weight: bold;
			}

			.distance {
  				width: 100px;
			}

			.inputGroup {
				background-color: #AAAAAA;
				margin-right: 5px;
				margin-left: 5px;
				margin-bottom: 5px;

				float: left;
			}

			.time {
				text-align: right;
			}

			.time_segment {
				width: 20px;
			}

			.units {
				width: 80px;
			}
		</style>
	</head>
	<body>
		<div>
			Units of distance: 
			<input type="radio" name="calc_units" id="calc_units_miles" value="mile" checked="yes"></input>Miles
			<input type="radio" name="calc_units" id="calc_units_km" value="km"></input>Kilometers			
		</div>

		<div>
			<h2>Distance &amp; Time to Minutes/<span class="units_label">mile</span></h2>

			<div class="inputGroup">
				<table>
					<tr>
						<th>Distance (<span class="units_label">mile</span>)</th>
						<th>Hours</th>
						<th>Minutes</th>
						<th>Seconds</th>
					</tr>
					<tr>
	 					<td><input type="text" id="calc_mpm_dist" value="1" class="distance"></input></td>
						<td><input type="text" id="calc_mpm_hh" value="0" class="time_segment"></input></td>
						<td><input type="text" id="calc_mpm_mm" value="0" class="time_segment"></input></td>
						<td><input type="text" id="calc_mpm_ss" value="0" class="time_segment"></input></td>
					</tr>
				</table>

				<button id="calc_mpm_calc">calc</button>
			</div>

			<div class="clear"></div>

			Result (per <span class="units_label">mile</span>): <span type="text" id="calc_mpm_result" class="time"></span>
		</div>
		<div>
			<h2>Minutes/<span class="units_label">mile</span> to Distance &amp; Time</h2>

			<div>
				<div class="inputGroup">
					<table>
						<tr>
							<th>Distance (<span class="units_label">mile</span>, optional)</th>
						</tr>
						<tr>
							<td><input type="text" id="calc_dist_dist" value="0" class="distance"></input></td>
						</tr>
					</table>					
				</div>

				<div class="clear"></div>

				<div class="inputGroup">
					<table>
						<tr>
							<th>Minutes</th>
							<th>Seconds</th>
						</tr>
						<tr>
							<td><input type="text" id="calc_dist_mm" value="0" class="time_segment"></input></td>
							<td><input type="text" id="calc_dist_ss" value="0" class="time_segment"></input></td>
						</tr>
					</table>
	
					<button id="calc_dist_calc_time">calc</button>
				</div>
				<div style="float: left;">
					or  
				</div>
				<div class="inputGroup">
					<table>
						<tr>
							<th><span class="units_label">mile</span>/h</th>
						</tr>
						<tr>
							<td><input type="text" id="calc_dist_uph" value="1" class="units"></td>
						</tr>
					</table>					 

					<button id="calc_dist_calc_uph">calc</button>					
				</div>

				<div class="clear"></div>

				<table>
					<thead>
						<tr>
							<th>Distance</th>
							<th>Time</th>
						</tr>
					</thead>
					<tbody id="calc_dist_results">
					</tbody>																				
				</table>				
			</div>
		</div>
		<div>
			<h2><span class="units_label">mile</span>s per hour to Minutes per <span class="units_label">mile</span></h2>

			<div class="inputGroup">
				<table>
					<tr>
						<th><span class="units_label">mile</span>/h</th>
					</tr>
					<tr>
						<td><input type="text" id="calc_utom_uph" value=""></input></td>
					</tr>
				</table>	
			</div>
			<div class="inputGroup">
				<button id="calc_utom_uph_to_mpm">&gt;</button><br/>
				<button id="calc_utom_mpm_to_uph">&lt;</button>
			</div>
			<div class="inputGroup">
				<table>
					<tr>
						<th>Minutes</th>
						<th>Seconds</th>
					</tr>
					<tr>
						<td><input type="text" id="calc_utom_mm" value="0" class="time_segment"></input></td>
						<td><input type="text" id="calc_utom_ss" value="0" class="time_segment"></input></td>
					</tr>
				</table>			
			</div>						
		</div>
		<script type="text/javascript">
			var distances = {
				'1 mile': 1,
				'5K': 3.10686,
				'8K': 4.97097,
				'10K': 6.21371,
				'15K': 9.32057,
				'10 mile': 10,
				'Half Marathon': 13.1094,
				'Marathon': 26.2188,
				'50K': 31.0686,
				'50 mile': 50,
				'100K': 62.1371,
				'100 mile': 100
			};

			function parseNumber(s) {
				s = s.replace(/[^0-9.]/g, '');

				if(s == '')
					return NaN;

				return parseFloat(s) || 0;
			} 

			function pad(s, n) {
				if(s.length < n)
					return '0' + s;

				return s;
			}

			function secondsToTime(ss) {
				return (ss >= 3600 ? Math.floor(ss / 3600.0 % 3600.0) + ':' : '') + 
					pad(Math.floor(ss / 60.0 % 60.0).toString(), 2) + ':' + 
					pad((ss % 60.0).toFixed(2), 5);
			}

			function secondsPerDistanceToTime(dist, seconds) {
				return secondsToTime(seconds / dist);
			}

			function timePartsToSeconds(hh, mm, ss) {
				return (hh * 60 * 60) + (mm * 60) + ss;
			}

			function calcMilesPerMinute(dist, hh, mm, ss) {	
				return secondsPerDistanceToTime(dist, timePartsToSeconds(hh, mm, ss));
			}

			function secondsForDistance(dist, spu) {
				return dist * spu;
			}

			function timeForDistance(dist, spu) {
				return secondsToTime(secondsForDistance(dist, spu));
			}

			function calcTimes(spu, scale) {				
				var times = {};

				for(distName in distances) {
					times[distName] = timeForDistance(distances[distName] * scale, spu);
				}

				return times;
			}

			function getDistanceMode() {
				return $('input:radio[name=calc_units]:checked').val();
			}

			$('input:radio[name=calc_units]').click(function() {
				$('.units_label').text(getDistanceMode());
			});

			$('#calc_mpm_calc').click(function() {
				var dist, hh, mm, ss;

				if(isValid(dist = parseNumber($('#calc_mpm_dist').val())) && 
						isValid(hh = parseNumber($('#calc_mpm_hh').val())) && 
						isValid(mm = parseNumber($('#calc_mpm_mm').val())) && 
						isValid(ss = parseNumber($('#calc_mpm_ss').val()))) {

					var time = calcMilesPerMinute(dist, hh, mm, ss);

					$('#calc_mpm_result').text(time);
				} else {
					$('#calc_mpm_result').text('');
				}
			});

			function calcDistanceTimes(spu) {
				if(isValid(spu)) {
					$('#calc_dist_results').html('');
					var scale = 1;

					if(getDistanceMode() == 'km') {
						scale = 1.60934;
					}

					var times = times = calcTimes(spu, scale);
					var customDist = parseNumber($('#calc_dist_dist').val());

					if(customDist > 0 && isValid(customDist)) {
						$('#calc_dist_results').html('<tr class="custom_dist"><td>' + customDist + ' ' + getDistanceMode() + '</td><td>' + timeForDistance(customDist, spu) + '</td></tr>');
					}

					for(distName in distances) {
						$('#calc_dist_results').append('<tr><td>' + distName + '</td><td>' + times[distName] + '</td></tr>');
					}
				} else {
					$('#calc_dist_results').html('');
				}
			}

			function uphToUps(uph) {
				return uph / 60.0 / 60.0;
			}

			function upsToSpu(ups) {
				return  1 / ups;
			}

			function spuToUps(spu) {
				return  1 / spu;
			}

			function isValid(n) {
				return n >= 0 && isFinite(n);
			}

			$('#calc_dist_calc_uph').click(function() {
				var ups;

				if(isValid(ups = parseNumber($('#calc_dist_uph').val()))) {
					var spu = upsToSpu(uphToUps(ups));
					calcDistanceTimes(spu);
				} else {
					$('#calc_dist_results').html('');
				}
			});

			$('#calc_dist_calc_time').click(function() {
				var mm, ss;

				if(isValid(mm = parseNumber($('#calc_dist_mm').val())) && isValid(ss = parseNumber($('#calc_dist_ss').val()))) {
					var spu = timePartsToSeconds(0, mm, ss);
					calcDistanceTimes(spu);
				} else {
					$('#calc_dist_results').html('');
				}
			});

			$('#calc_utom_uph_to_mpm').click(function() {
				var spu = upsToSpu(uphToUps(parseNumber($('#calc_utom_uph').val())));

				if(isValid(spu)) {
					$('#calc_utom_mm').val(Math.floor(spu / 60));
					$('#calc_utom_ss').val(spu % 60);					
				} else {
					$('#calc_utom_mm').val(0);
					$('#calc_utom_ss').val(0);
				}
			});

			$('#calc_utom_mpm_to_uph').click(function() {		

				var ups = spuToUps(timePartsToSeconds(0, parseNumber($('#calc_utom_mm').val()), parseNumber($('#calc_utom_ss').val())));
				if(isValid(ups)) {
					$('#calc_utom_uph').val(ups * 60 * 60);
				} else {
					$('#calc_utom_uph').val(0);
				}
			});

			(function() {
				$('.units_label').text(getDistanceMode());
			})();
		</script>
	</body>
</html>
